<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Favicon -->
    <link href="img/favicon.ico" rel="icon">
   
    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600&family=Nunito:wght@600;700;800&display=swap" rel="stylesheet">
   
    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">
   
    <!-- Libraries Stylesheet -->
    <link href="lib/animate/animate.min.css" rel="stylesheet">
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet" />
     
         <!-- Customized Bootstrap Stylesheet -->
         <link href="css/bootstrap.min.css" rel="stylesheet">
     
         <!-- Template Stylesheet -->
         <link href="css/style.css" rel="stylesheet">
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     
     <style>
        .error{
            color: red;
        }
     </style>
   </head>
<body>
   <!-- Spinner Start -->
   <div id="spinner" class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
    <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
        <span class="sr-only">Loading...</span>
    </div>
</div>
<!-- Spinner End -->

<!-- Topbar Start -->
<section class="admin_login"  id="loginContainer"style="height: 100vh; background: url(./img/bck-main.webp); background-position: center; background-size: cover;">
    <div class="container  "   >
        <div class="row justify-content-center">
            <div class="col-lg-5 col-md-5 Small shadow p-5 position-absolute " style="border-radius: 10px; top: 25%; border: 1px solid #e7e6e65c; background-color: white;">
                <div class="text-center"><h2> Admin Login</h2></div>
                <form id="loginForm">
                    <div class="form-group mt-3">
                        <label for="email">Email:</label>
                        <input type="email" id="email" class="form-control pt-2 pb-2" name="email" style="background: #ffffff16; border-radius: 8px; " required><br>
                    </div>
    
                    <div class="form-group mt-3">
                        <label for="password">Password:</label>
                        <input type="password" id="password" class="form-control pt-2 pb-2" name="password" style="background: #ffffff16; border-radius: 8px; " required><br>
                    </div> 
                    <div class="d-flex justify-content-center">
                        <button type="button" style="width:100%; border-radius: 8px;" class= "btn btn-primary mt-4 pt-2 pb-2"  id="submitButton"  onclick="login()">Login</button>
                    </div>
                </form>
            </div>
        </div>
    
    </div>
</section>


<section class="mt-4" id="registerContainer"   style="display: none;" >
    <div class="container-fluid ">
    <div class="row">
      <div class="col-lg-12" >
      <div class="d-flex justify-content-between align-items-center p-4" style="border: 1px solid #00000068; border-radius: 8px;">
        <div>
          <div style="font-size: 20px; font-weight: bold; color: #000000;">Admin</div>
        </div>
          <div><button class="btn btn-primary" onclick="togeluserRgister()"><i class="fa fa-plus" aria-hidden="true"></i> Register-user </button></div>
      </div>


        <div class="row justify-content-center mt-3" >
            <div id="register" class="col-lg-5 col-md-5 Small shadow p-5" style="border-radius: 10px; display: none; background-color: #ffffff16;">
                <div class="d-flex justify-content-end" >
                    <button type="button" onclick="closeForm()" style="background: none; outline: none; border: none; font-size: 30px;">&times;</button>
                  </div>
                <div class="text-center"><h2> User Registration</h2></div>
                <form id="signupForm">


     <div class="form-group mt-3">
    <label for="registerName">Name:</label>
    <input type="text" id="registerName" class="form-control" name="name" oninput="clearError('registerName')" required ><br>
    <div id="nameError" class="error"></div>
</div>

<div class="form-group mt-3">
    <label for="registerEmail">Email:</label>
    <input type="email" id="registerEmail" class="form-control" name="email" oninput="clearError('registerEmail')" required><br>
    <div id="emailError" class="error"></div>
</div>

<div class="form-group mt-3">
    <label for="registerPassword">Password:</label>
    <input type="password" id="registerPassword" class="form-control" name="password" oninput="clearError('registerPassword')" required><br>
    <div id="passwordError" class="error"></div>
</div>

<div class="form-group mt-3">
    <label for="registerPhone">Phone:</label>
    <input type="phone" id="registerPhone" class="form-control" name="phone"   inputmode="numeric"
    pattern="[0-9\s]{13,19}" oninput="clearError('registerPhone')"  required><br>
    <div id="phoneError" class="error"></div>
</div>

                    <div class="d-flex justify-content-center">
                        <button type="button" style="width:100%;" class="btn btn-primary mt-4 pt-2 pb-2" onclick="registerUser()">Register</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
      </div>
    </div>


    <div class="container-fluid">
        <div class="row">
          <div class="container">
            <div class="row m-2">
              <div class=" mt-2 mb-2 "><h2 class="">Registered User-List</h2></div>
              <table class="table">
                <thead>
                  <tr>
                    <th scope="col">#</th>
                    <th scope="col">Name</th>
                    <th scope="col">Email</th>
                    <th scope="col">PhoneNumber</th>
                    <th scope="col">RemoveUser</th>
                  </tr>
                </thead>
                <tbody id="userTableBody">
           
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      
</section>


<!-- Add your script tags for libraries and your custom script here -->
    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="lib/wow/wow.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="lib/tempusdominus/js/moment.min.js"></script>
    <script src="lib/tempusdominus/js/moment-timezone.min.js"></script>
    <script src="lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>

    <!-- Template Javascript -->
    <script src="js/main.js">
    </script>
   <script>

function displayError(inputId, error) {
    const errorDiv = document.getElementById(`${inputId}Error`);
    console.log(errorDiv)
    if (errorDiv) {
        errorDiv.innerText = error;
        errorDiv.style.display = 'block';
    } else {
    }
}

function clearError(inputId) {
    const errorDiv = document.getElementById(`${inputId}Error`);
    if (errorDiv) {
        errorDiv.innerText = '';
        errorDiv.style.display = 'none';
    } else {
       
    }
}

 function toggleButtonState(isDisabled) {
 const submitButton = document.getElementById('submitButton');
 submitButton.disabled = isDisabled;
}

        function handleApiError(error) {
            console.error('Error:', error.message);
            // alert('An error occurred. Please try again.');
            toggleButtonState(false);
        }

        function handleInputFocus() {
            this.style.borderColor = '';
        }

        function handleInputBlur() {
            const value = this.value.trim();
            if (value === '') {
                this.style.borderColor = 'red';
            }
        }

        function login() {
            const emailInput = document.getElementById('email');
            const passwordInput = document.getElementById('password');

            const email = emailInput.value;
            const password = passwordInput.value;

            emailInput.style.borderColor = '';
            passwordInput.style.borderColor = '';

            toggleButtonState(true);

            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

            if (!emailRegex.test(email)) {
                alert('Invalid email format');
                emailInput.style.borderColor = 'red';
                toggleButtonState(false);
                return;
            }

            if (!email || !password) {
                alert('Please enter both email and password');
                toggleButtonState(false);
                return;
            }

            const loginCredentials = {
                email: email,
                password: password,
            };

            const apiUrl = "https://katchintours.swiftexwallet.com/api/signin";

            fetch(apiUrl, {
                method: "POST",
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(loginCredentials)
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    console.error('Login failed:', data.error);
                    alert('Invalid Credentials');
                    emailInput.style.borderColor = 'red';
                    passwordInput.style.borderColor = 'red';
                    toggleButtonState(false);
                } else {
                    console.log('Login successful:', data);
                    localStorage.setItem('token', data.token);
                    document.getElementById("loginContainer").style.display = "none";
                    document.getElementById("registerContainer").style.display = "block";
                    // getPackageData();
                    getAllrgisterUser();
                    toggleButtonState(false);
                }
            })
            .catch(handleApiError);
        }
        document.getElementById('email').addEventListener('focus', handleInputFocus);
        document.getElementById('email').addEventListener('blur', handleInputBlur);
        document.getElementById('password').addEventListener('focus', handleInputFocus);
        document.getElementById('password').addEventListener('blur', handleInputBlur);

async function registerUser() {
    function displayError(inputId, error) {
      const errorDiv = document.getElementById(`${inputId}Error`);
      errorDiv.innerText = error;
      errorDiv.style.display = 'block';
    }
    
    function clearError(inputId) {
      const errorDiv = document.getElementById(`${inputId}Error`);
      errorDiv.innerText = '';
      errorDiv.style.display = 'none';
    }

    try {

        document.querySelectorAll('.error').forEach(errorDiv => {
          errorDiv.innerText = '';
          errorDiv.style.display = 'none';
        });


        const name = document.getElementById('registerName').value;
        const email = document.getElementById('registerEmail').value;
        const password = document.getElementById('registerPassword').value;
        const phoneNumber = document.getElementById('registerPhone').value;


         if (!name) {
          alert('Name is required')
          throw { field:'registerName', message: 'Name is required' };
        }

        if (!email) {
          alert('Email is required')
          throw { field: 'registerEmail', message: 'Email is required' };
        } else if (!/^\S+@\S+\.\S+$/.test(email)) {
          alert( 'Invalid email format')
          throw { field: 'registerEmail', message: 'Invalid email format' };
        }

        if (!password) {
          alert(  'Password is required' )
          throw { field: 'registerPassword', message: 'Password is required' };

        } else if (password.length < 8) {
          alert( 'Password must be at least 8 characters' )
          throw { field: 'registerPassword', message: 'Password must be at least 8 characters' };

        }

        if (!phoneNumber) {
          alert( 'Phone Number is required'  )     
          throw { field: 'registerPhone', message: 'Phone Number is required' };  
        } else if (!/^\d+$/.test(phoneNumber)) {
          alert( 'Phone Number must be an integer'  )   
          throw { field: 'registerPhone', message: 'Phone Number must be an integer' };    
        } else if (phoneNumber.length !== 10) {
          alert( 'Phone Number must be 10 digits'  )   
          throw { field: 'registerPhone', message: 'Phone Number must be 10 digits' };

        }


        const registrationData = {
            name: name,
            email: email,
            password: password,
            phoneNumber: phoneNumber
        };

        const apiUrl = "https://katchintours.swiftexwallet.com/api/signup";

        const authToken = localStorage.getItem('token');

        if (!authToken) {
            throw new Error('Authentication token not found in local storage');
        }

        const response = await fetch(apiUrl, {
            method: "POST",
            headers: {
                'Authorization': `Bearer ${authToken}`,
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(registrationData)
        });

        const data = await response.json();

        if (data.error) {
            console.error('Registration failed:', data.error);
            alert('Something went wrong');
        } else {

            alert('user registred succsfully');
            getAllrgisterUser()
            console.log('Account create successfully. Please login', data);
            document.getElementById('registerName').value = '';
            document.getElementById('registerEmail').value = '';
            document.getElementById('registerPassword').value = '';
            document.getElementById('registerPhone').value = '';

            
            document.getElementById("registerContainer").style.display = "block";
            document.getElementById('register').style.display='none'
        }

    } catch (error) {
        console.error('Error:', error.message);
    }
}
function togeluserRgister (){
    let rgisterContainer = document.getElementById('register')
      if(rgisterContainer.style.display==='none'){
        rgisterContainer.style.display='block'
      } else{
       
      }
}

function closeForm (){
let closeFormContainer = document.getElementById('register');
closeFormContainer.style.display = 'none';
}

async function getAllrgisterUser() {
  const apiUrl = 'https://katchintours.swiftexwallet.com/api/user/all-user';
  const authToken = localStorage.getItem('token');

  try {
    if (!authToken) {
      throw new Error('Authentication token is not found');
    }

    const response = await fetch(apiUrl, {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${authToken}`,
      },
    });

    if (response.ok) {
      const data = await response.json();
    //   const users = data.Users
      updateTable(data.Users);
    }
  } catch (error) {
    console.error(error);
  }
}

function updateTable(data) {
    console.log(data)
  const tableBody = document.getElementById('userTableBody');
  tableBody.innerHTML = ''; 

  data?.forEach((user, index) => {
    console.log(user)
    const row = document.createElement('tr');
    row.innerHTML = `
      <th scope="row">${index + 1}</th>
      <td>${user.name}</td>
      <td>${user.email}</td>
      <td>${user.phoneNumber}</td>
      <td><button class='btn btn-danger' onclick="DeleteUser('${user._id}')" style={border:'none':, outline:'none'}> <i class="fa fa-minus-circle" aria-hidden="true"></i> Removeuser</button></td>
    `;
    tableBody.appendChild(row);
  });
}


async function DeleteUser(userId) {
    const apiUrl = 'https://katchintours.swiftexwallet.com/api/user/delete-user'; 
    const authToken = localStorage.getItem('token');

    try {
        const response = await fetch(apiUrl, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${authToken}`,
               
            },
            body: JSON.stringify({
                oId: userId,
            }),
        });

        if (!response.ok) {
            throw new Error(`Error deleting user: ${response.status} - ${response.statusText}`);
        }
      
         alert('User deleted successfully')
        console.log('User deleted successfully');
        getAllrgisterUser()
    } catch (error) {
        console.error('Error:', error.message);
    }
}



</script>
</body>
</html>

